# Should be used in defaults list, e.g.
# - /driver: transfuser
# Type validation happens at driver runtime via OmegaConf.structured merge

defaults:
  - transfuser_runtime_configs  # Camera and simulation configs
  - _self_                      # YAML values override schema defaults

# Transfuser Driver Configuration for Alpasim

# Logging level (uses wizard's global setting)
log_level: ${wizard.log_level}

# Model configuration
model:
  model_type: TRANSFUSER  # Model type: VAM or TRANSFUSER
  checkpoint_path: "/mnt/drivers/transfuser/model_0060.pth"  # Path to checkpoint (config.json must be in same dir)
  device: "cuda"
  # tokenizer_path not needed for Transfuser

# Server configuration
host: "0.0.0.0"
port: ???

# Inference configuration
inference:
  # Transfuser requires exactly 4 cameras concatenated horizontally
  # Order matters - determines concatenation order (left to right)
  use_cameras:
    - "camera_cross_left_120fov"
    - "camera_front_wide_120fov"
    - "camera_cross_right_120fov"
    - "camera_rear_left_70fov"
  max_batch_size: 16
  subsample_factor: 1
  # context_length: null  # Transfuser is single-frame, uses default of 1

# Rectification configuration for all 4 cameras
# Rectify f-theta renders back to the NuPlan pinhole model
rectification:
  # L0 - cross left camera
  camera_cross_left_120fov:
    focal_length: [1545.0, 1545.0]
    principal_point: [960.0, 560.0]
    resolution_hw: [1080, 1920]
    radial: [-0.356123, 0.172545, -0.052310, 0.0, 0.0, 0.0]
    tangential: [-0.002130, 0.000464]
    thin_prism: [0.0, 0.0, 0.0, 0.0]
    max_overscan_scale: 2.0
    safety_margin_px: 10

  # F0 - front wide camera
  camera_front_wide_120fov:
    focal_length: [1545.0, 1545.0]
    principal_point: [960.0, 560.0]
    resolution_hw: [1080, 1920]
    radial: [-0.356123, 0.172545, -0.052310, 0.0, 0.0, 0.0]
    tangential: [-0.002130, 0.000464]
    thin_prism: [0.0, 0.0, 0.0, 0.0]
    max_overscan_scale: 2.0
    safety_margin_px: 10

  # R0 - cross right camera
  camera_cross_right_120fov:
    focal_length: [1545.0, 1545.0]
    principal_point: [960.0, 560.0]
    resolution_hw: [1080, 1920]
    radial: [-0.356123, 0.172545, -0.052310, 0.0, 0.0, 0.0]
    tangential: [-0.002130, 0.000464]
    thin_prism: [0.0, 0.0, 0.0, 0.0]
    max_overscan_scale: 2.0
    safety_margin_px: 10

  # B0 - rear camera
  camera_rear_left_70fov:
    focal_length: [1545.0, 1545.0]
    principal_point: [960.0, 560.0]
    resolution_hw: [1080, 1920]
    radial: []
    tangential: []
    thin_prism: []
    max_overscan_scale: 2.0
    safety_margin_px: 10

# Route configuration
route:
  default_command: 2  # Default command: 0=right, 1=left, 2=straight
  use_waypoint_commands: true
  command_distance_threshold: 3.0  # Lateral displacement threshold in meters
  min_lookahead_distance: 20.0  # Minimum distance to look ahead for waypoints in meters

# Output configuration
output_dir: "/mnt/output/driver"

# Trajectory optimization (disabled by default for Transfuser)
trajectory_optimizer:
  enabled: false

plot_debug_images: false
